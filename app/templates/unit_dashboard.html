{% extends "base.html" %}
{% block content %}
<h3 class="mb-3">處理單位後台</h3>

<div class="card">
  <div class="card-header bg-dark text-white">分派案件清單</div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>案件編號</th>
            <th>類型</th>
            <th>地點</th>
            <th>狀態</th>
            <th>時間</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          {% for c in cases %}
          <tr>
            <td>{{ c.case_id }}</td>
            <td>{{ c.event_type }}</td>
            <td>{{ c.location_text }}</td>
            <td>{{ c.status }}</td>
            <td>{{ c.report_time.strftime('%Y/%m/%d %H:%M') }}</td>
            <td>
              <!-- 查看詳情 -->
              <a class="btn btn-sm btn-outline-primary"
                 href="{{ url_for('case_detail', case_id=c.case_id) }}">詳情</a>

              <!-- 更新進度 -->
              <form method="post" action="{{ url_for('admin_case_review', case_id=c.case_id) }}" class="d-inline">
                <button class="btn btn-sm btn-success" name="action" value="in_progress">進行中</button>
                <button class="btn btn-sm btn-info" name="action" value="complete">完成</button>
              </form>

              <!-- 請求補充資料 -->
              <form method="post" action="{{ url_for('unit_request_info', case_id=c.case_id) }}" class="d-inline">
                <input type="text" name="message"
                       class="form-control form-control-sm d-inline w-auto"
                       placeholder="補充資料訊息">
                <button class="btn btn-sm btn-warning">請求補充</button>
              </form>

              <!-- 轉派功能 -->
              <form method="post" action="{{ url_for('unit_reassign', case_id=c.case_id) }}" class="d-inline">
                <select name="unit_id" class="form-select form-select-sm d-inline w-auto">
                  {% for u in units %}
                    <option value="{{ u.id }}">{{ u.unit_name }}</option>
                  {% endfor %}
                </select>
                <button class="btn btn-sm btn-primary">轉派</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
